#!/usr/bin/env python

import sys

INSERT = "SELECT create_route ('%s', %i, '%s');"


def readAttr(line):
    sp = line.split(':',1)[1]
    if '#' in sp:
        sp = sp.split('#',1)[0]
    return sp.strip()


def convertASDot(origin):
    if '.' in origin:
        high, low = map(int, origin.split('.'))
        origin = (high << 16) + low
    return origin


def main():

    route  = None
    origin = None
    source = None

    for line in sys.stdin:

        if line.strip() == '': # new block
            if route and origin and source:
                print INSERT % (route, origin, source)
            route = origin = source = None

        if line.startswith('route:'):
            route = readAttr(line)
            pfl = int(route.split('/',1)[1])
            if pfl < 8 or pfl > 24:
                print >> sys.stderr, '-- Invalid prefix length for route', route, 'skipping'
                route = None
                continue

        elif line.startswith('origin:'):
            origin = readAttr(line)[2:]
            origin = convertASDot(origin)
            origin = int(origin)

        elif line.startswith('source:'):
            source = readAttr(line).lower()

    # dangling route
    if route and origin and source:
        print INSERT % (route, origin, source)


if __name__ == '__main__':
    main()

